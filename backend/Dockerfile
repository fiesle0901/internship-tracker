FROM node:20-alpine
WORKDIR /app  
COPY package*.json ./
RUN npm install
COPY . .
ENV DATABASE_URL="postgresql://placeholder:placeholder@localhost:5432/placeholder"  
RUN npx prisma generate
RUN npm run build

EXPOSE 5001

CMD ["sh", "-c", "npx prisma migrate deploy && node dist/server.js"]